<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.EatStamp.mapper.MemberAdminMapper">  

	<!-- 회원목록 -->
	<select id="selectMemList" parameterType="map" resultType="memberVO">
		SELECT 
			mem_num,
			mem_email,
			mem_nick,
			mem_birth,
			mem_genderCode,
			mem_branchCode,
			mem_admin_auth
		FROM(
			SELECT
				@rownum:=@rownum+1 AS rn,
				mem_num,
				mem_email,
				mem_nick,
				mem_birth,
				mem_genderCode,
				mem_branchCode,
				mem_admin_auth
			FROM eatstamp.member, (SELECT @rownum:=0) TMP
	        <where>
	        	AND mem_admin_auth != 1
	            <if test="searchType != '' and searchKeyword != ''">
	                <choose>
	                    <when test="searchType == 'email'">
	                        AND mem_email LIKE CONCAT('%', #{searchKeyword}, '%')
	                    </when>
	                    <when test="searchType == 'nick'">
	                        AND mem_nick LIKE CONCAT('%', #{searchKeyword}, '%')
	                    </when>
	                </choose>
	            </if>
	        </where>
			ORDER BY mem_num DESC
			) t1
		WHERE rn BETWEEN #{start} and #{end}
	</select>
	
	<!-- 검색 결과 개수 -->
  	<select id="selectMemRowCount" resultType="int">
  		SELECT 
  			COUNT(*) 
  		FROM eatstamp.member 
	    <where>
	    	AND mem_admin_auth != 1
	        <if test="searchType != '' and searchKeyword != ''">
	            <choose>
	                <when test="searchType == 'email'">
	                    AND mem_email LIKE CONCAT('%', #{searchKeyword}, '%')
	                </when>
	                <when test="searchType == 'nick'">
	                    AND mem_nick LIKE CONCAT('%', #{searchKeyword}, '%')
	                </when>
	            </choose>
	        </if>
	    </where>
  	</select>
  	
  	<!-- 회원 상태 업데이트 -->
  	<update id="updateMemberStatus" parameterType="map">
  		UPDATE eatstamp.member
  		SET mem_admin_auth = #{mem_admin_auth}
  		WHERE mem_num = #{mem_num}
  	</update>

</mapper>